{% extends "base.html" %}

{% block title %}Recipe Results ¬∑ Recipe Jam{% endblock %}

{% block extra_css %}
<style>
  .recipe-container {
    margin-top: 2rem;
  }

  .recipe-card {
    padding: 1.5rem;
    background: #ffffff;
    border-radius: 8px;
    border: 1px solid #e0e0e0;
    box-shadow: 0 2px 6px rgba(0,0,0,0.03);
  }

  .recipe-card h2 {
    margin-top: 0;
  }

  .pill {
    display: inline-block;
    padding: 0.25rem 0.75rem;
    border-radius: 999px;
    border: 1px solid #ddd;
    font-size: 0.8rem;
    margin-right: 0.5rem;
    margin-bottom: 0.25rem;
    background: #f8f9fa;
  }

  .section-title {
    margin-top: 1.5rem;
    margin-bottom: 0.5rem;
  }

  .back-link {
    margin-top: 1.5rem;
    display: inline-block;
    font-size: 0.9rem;
  }

  .status-text {
    color: #666;
    margin-bottom: 1rem;
  }

  .error-text {
    color: #b00020;
  }
</style>
{% endblock %}

{% block content %}
<h1>üç≤ Recipe Results</h1>

<div class="recipe-container">
  {% if include %}
    <p class="status-text">
      Using ingredients:
      <strong>{{ include | join(", ") }}</strong>
    </p>
  {% else %}
    <p class="status-text">
      No ingredients submitted yet. Go back to the ingredients page to add some.
    </p>
  {% endif %}

  {% if recipe %}
    <div class="recipe-card">
      <h2>{{ recipe.name or "Recipe suggestion" }}</h2>

      <div style="margin-bottom: 1rem;">
        {% if recipe.recipe_id %}
          <span class="pill">ID: {{ recipe.recipe_id }}</span>
        {% endif %}
      </div>

      <h3 class="section-title">Ingredients</h3>
      {% if recipe.ingredients %}
        <ul>
          {% for ing in recipe.ingredients %}
            <li>
              {% if ing.name %}
                {{ ing.name }}{% if ing.amount %} ‚Äì {{ ing.amount }}{% endif %}
              {% else %}
                {{ ing }}
              {% endif %}
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <p class="status-text">(No ingredients list provided)</p>
      {% endif %}

      <h3 class="section-title">Steps</h3>
      {% if recipe.steps %}
        <ol>
          {% for step in recipe.steps %}
            <li>{{ step }}</li>
          {% endfor %}
        </ol>
      {% else %}
        <p class="status-text">(No steps provided)</p>
      {% endif %}

      {% if recipe.tools %}
        <h3 class="section-title">Tools</h3>
        <p>
          {% for tool in recipe.tools %}
            <span class="pill">{{ tool }}</span>
          {% endfor %}
        </p>
      {% endif %}

      {% if recipe.substitutions %}
      <h3 class="section-title">Substitutions</h3>
      <ul>
        {# Case 1: substitutions is a dict, e.g. {"milk": "oat milk"} #}
        {% if recipe.substitutions is mapping %}
          {% for key, value in recipe.substitutions.items() %}
        <li>{{ key }} ‚Üí {{ value }}</li>
        {% endfor %}
        {# Case 2: substitutions is a list of strings, like from the ML client #}
        {% else %}
        {% for sub in recipe.substitutions %}
        <li>{{ sub }}</li>
        {% endfor %}
        {% endif %}
      </ul>
      {% endif %}
    </div>
  {% else %}
    <p class="status-text">
      No recipe suggestions yet. Try entering some ingredients on the ingredients page.
    </p>
  {% endif %}

  {% if other_suggestions %}
    <h2 class="section-title">Other suggestions</h2>
    <ul>
      {% for r in other_suggestions %}
        <li>{{ r.name }}</li>
      {% endfor %}
    </ul>
  {% endif %}

  <a href="{{ url_for('pages.ingredients') }}" class="back-link">
    ‚Üê Back to My Ingredients
  </a>
</div>
{% endblock %}

{% block extra_js %}
{% endblock %}
